<html>
<header>
</header>

<body>
  <h1>Can memory in wasm module get changed from the hostcode after it is imported?</h1>
  <button id="change-mem">Try to change the imported memory from the hostcode</button>
  <h3>Memory state at address 0: <span id='mem-state'></span></h3>
  <h1>Answer: Yes it can!</h1>
  <script type='text/javascript'>
    let mem
    let instance
    (async function () {
      mem = new WebAssembly.Memory({ initial: 1 })
      let wasm = await fetch('mem.wasm')
        .then(res => res.arrayBuffer())
        .then(arrayBuffer => WebAssembly.instantiate(arrayBuffer, { js: { mem } }))
      instance = wasm.instance
    })()
    document.querySelector('#change-mem').addEventListener('click', () => {
      new Uint8Array(mem.buffer)[0] = Math.random() * 100 % 100
    })
    document.addEventListener('click', () => {
      document.querySelector('#mem-state').innerHTML = instance.exports.getMemState()
    })
  </script>
</body>

</html>